{"version":3,"sources":["file:///D:/SharderTest/demo/Creator3.0.0_2D_Sprite_GaussianBlur/assets/script/GaussianBlur.ts"],"names":["_decorator","Component","Slider","Label","dynamicAtlasManager","find","RenderComponent","Vec2","ccclass","property","GaussionBlur","onLoad","enabled","_blurSlider","getComponent","_blurSliderLabel","_examplesParentNode","onEnable","node","on","_onSliderChanged","onDisable","off","start","string","progress","toFixed","_updateRenderComponentMaterial","param","children","forEach","childNode","getComponents","renderComponent","material","getMaterial","_w","_gsFactor","_h","setProperty","console","log","setMaterial"],"mappings":";;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,mB,OAAAA,mB;AAC3CC,MAAAA,I,OAAAA,I;AAAYC,MAAAA,e,OAAAA,e;AAA2BC,MAAAA,I,OAAAA,I;;;;;;;AACnCC,MAAAA,O,GAAsBR,U,CAAtBQ,O;AAASC,MAAAA,Q,GAAaT,U,CAAbS,Q;;8BAGJC,Y,WADZF,OAAO,CAAC,cAAD,C;;;;;;;;;;;;sEAMyB,G;;;;;;;AAAK;eAElCG,M,GAAA,kBAAU;AACNP,UAAAA,mBAAmB,CAACQ,OAApB,GAA8B,KAA9B;AAEA,eAAKC,WAAL,GAAmBR,IAAI,CAAC,6CAAD,CAAJ,CAAqDS,YAArD,CAAkEZ,MAAlE,CAAnB;AACA,eAAKa,gBAAL,GAAwBV,IAAI,CAAC,iDAAD,CAAJ,CAAyDS,YAAzD,CAAsEX,KAAtE,CAAxB;AACA,eAAKa,mBAAL,GAA2BX,IAAI,CAAC,oCAAD,CAA/B;AACH,S;;eAEDY,Q,GAAA,oBAAW;AACP,eAAKJ,WAAL,CAAiBK,IAAjB,CAAsBC,EAAtB,CAAyB,OAAzB,EAAkC,KAAKC,gBAAvC,EAAyD,IAAzD;AACH,S;;eAEDC,S,GAAA,qBAAY;AACR,eAAKR,WAAL,CAAiBK,IAAjB,CAAsBI,GAAtB,CAA0B,OAA1B,EAAmC,KAAKF,gBAAxC,EAA0D,IAA1D;AACH,S;;eAEDG,K,GAAA,iBAAQ;AACJ,eAAKH,gBAAL;AACH,S;;eAEOA,gB,GAAR,4BAA2B;AACvB,eAAKL,gBAAL,CAAsBS,MAAtB,QAAkC,KAAKX,WAAL,CAAiBY,QAAjB,CAA0BC,OAA1B,CAAkC,CAAlC,CAAlC,CADuB,CAGvB;;AACA,eAAKC,8BAAL,CAAoC,EAApC;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;eACYA,8B,GAAR,wCAAuCC,KAAvC,EAAkD;AAAA;;AAC9C,eAAKZ,mBAAL,CAAyBa,QAAzB,CAAkCC,OAAlC,CAA0C,UAAAC,SAAS,EAAI;AACnDA,YAAAA,SAAS,CAACC,aAAV,CAAwB1B,eAAxB,EAAyCwB,OAAzC,CAAiD,UAAAG,eAAe,EAAI;AAChE,kBAAIC,QAAkB,GAAGD,eAAe,CAACE,WAAhB,CAA4B,CAA5B,CAAzB,CADgE,CAEhE;AACA;;AAEA,kBAAIC,EAAE,GAAG,MAAI,CAACC,SAAL,GAAiB,CAAC,MAAI,CAACA,SAAL,GAAe,EAAhB,IAAsB,MAAI,CAACxB,WAAL,CAAiBY,QAAjE;;AACA,kBAAIa,EAAE,GAAG,MAAI,CAACD,SAAL,GAAiB,CAAC,MAAI,CAACA,SAAL,GAAe,EAAhB,IAAsB,MAAI,CAACxB,WAAL,CAAiBY,QAAjE;;AACAS,cAAAA,QAAQ,CAACK,WAAT,CAAqB,aAArB,EAAoC,IAAIhC,IAAJ,CAAS6B,EAAT,EAAaE,EAAb,CAApC;AACAE,cAAAA,OAAO,CAACC,GAAR,CAAY,SAASL,EAArB;AACAI,cAAAA,OAAO,CAACC,GAAR,CAAY,SAASH,EAArB;AAEAL,cAAAA,eAAe,CAACS,WAAhB,CAA4BR,QAA5B,EAAsC,CAAtC;AACH,aAZD;AAaH,WAdD;AAeH,S;;;QAzD6BjC,S","sourcesContent":["\r\nimport { _decorator, Component, Slider, Label, dynamicAtlasManager,\r\n    find, Node, RenderComponent, Material, Vec2, pipeline } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GaussionBlur')\r\nexport class GaussionBlur extends Component {\r\n\r\n    private _blurSlider !: Slider;\r\n    private _blurSliderLabel !: Label;\r\n    private _examplesParentNode !: Node;\r\n    private _gsFactor : number = 500; // 调整高斯模糊系数 (建议 50 ~ 5000)\r\n\r\n    onLoad () {\r\n        dynamicAtlasManager.enabled = false;\r\n\r\n        this._blurSlider = find(\"Canvas/Content/Controller/BlurSlider/Slider\")!.getComponent(Slider)!;\r\n        this._blurSliderLabel = find(\"Canvas/Content/Controller/BlurSlider/ValueLabel\")!.getComponent(Label)!;\r\n        this._examplesParentNode = find(\"Canvas/Content/ScrollView/Examples\")!;\r\n    }\r\n\r\n    onEnable() {\r\n        this._blurSlider.node.on(\"slide\", this._onSliderChanged, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this._blurSlider.node.off(\"slide\", this._onSliderChanged, this);\r\n    }\r\n\r\n    start() {\r\n        this._onSliderChanged();\r\n    }\r\n\r\n    private _onSliderChanged() {\r\n        this._blurSliderLabel.string = `${this._blurSlider.progress.toFixed(2)}`;\r\n\r\n        // 更新材质\r\n        this._updateRenderComponentMaterial({});\r\n    }\r\n\r\n    /**\r\n     * 更新渲染组件的材质\r\n     *\r\n     * 1. 获取材质\r\n     * 2. 给材质的 unitform 变量赋值\r\n     * 3. 重新将材质赋值回去\r\n     */\r\n    private _updateRenderComponentMaterial(param: {}) {\r\n        this._examplesParentNode.children.forEach(childNode => {\r\n            childNode.getComponents(RenderComponent).forEach(renderComponent => {\r\n                let material: Material = renderComponent.getMaterial(0)!;\r\n                // let _w = 1000 - 990 * this._blurSlider.progress;\r\n                // let _h = 1000 - 990 * this._blurSlider.progress;\r\n\r\n                let _w = this._gsFactor - (this._gsFactor-30) * this._blurSlider.progress;\r\n                let _h = this._gsFactor - (this._gsFactor-30) * this._blurSlider.progress;\r\n                material.setProperty('textureSize', new Vec2(_w, _h));\r\n                console.log(\"w : \" + _w);\r\n                console.log(\"h : \" + _h);\r\n\r\n                renderComponent.setMaterial(material, 0);\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n"]}